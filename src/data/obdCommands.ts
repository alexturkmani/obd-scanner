// OBD-II PID definitions and command mappings

export interface OBDCommand {
  pid: string;
  name: string;
  description: string;
  unit: string;
  min: number;
  max: number;
  formula: (bytes: number[]) => number;
}

// Mode 01 - Current Data PIDs
export const MODE_01_PIDS: Record<string, OBDCommand> = {
  '00': {
    pid: '0100',
    name: 'Supported PIDs [01-20]',
    description: 'PIDs supported [01-20]',
    unit: '',
    min: 0,
    max: 0,
    formula: (bytes) => bytes[0],
  },
  '04': {
    pid: '0104',
    name: 'Engine Load',
    description: 'Calculated engine load',
    unit: '%',
    min: 0,
    max: 100,
    formula: (bytes) => (bytes[0] * 100) / 255,
  },
  '05': {
    pid: '0105',
    name: 'Coolant Temp',
    description: 'Engine coolant temperature',
    unit: '째C',
    min: -40,
    max: 215,
    formula: (bytes) => bytes[0] - 40,
  },
  '0B': {
    pid: '010B',
    name: 'Intake Pressure',
    description: 'Intake manifold absolute pressure',
    unit: 'kPa',
    min: 0,
    max: 255,
    formula: (bytes) => bytes[0],
  },
  '0C': {
    pid: '010C',
    name: 'Engine RPM',
    description: 'Engine speed',
    unit: 'RPM',
    min: 0,
    max: 16383.75,
    formula: (bytes) => ((bytes[0] * 256) + bytes[1]) / 4,
  },
  '0D': {
    pid: '010D',
    name: 'Vehicle Speed',
    description: 'Vehicle speed',
    unit: 'km/h',
    min: 0,
    max: 255,
    formula: (bytes) => bytes[0],
  },
  '0F': {
    pid: '010F',
    name: 'Intake Air Temp',
    description: 'Intake air temperature',
    unit: '째C',
    min: -40,
    max: 215,
    formula: (bytes) => bytes[0] - 40,
  },
  '10': {
    pid: '0110',
    name: 'MAF Rate',
    description: 'Mass air flow sensor rate',
    unit: 'g/s',
    min: 0,
    max: 655.35,
    formula: (bytes) => ((bytes[0] * 256) + bytes[1]) / 100,
  },
  '11': {
    pid: '0111',
    name: 'Throttle Position',
    description: 'Throttle position',
    unit: '%',
    min: 0,
    max: 100,
    formula: (bytes) => (bytes[0] * 100) / 255,
  },
  '1C': {
    pid: '011C',
    name: 'OBD Standard',
    description: 'OBD standards this vehicle conforms to',
    unit: '',
    min: 0,
    max: 255,
    formula: (bytes) => bytes[0],
  },
  '1F': {
    pid: '011F',
    name: 'Run Time',
    description: 'Run time since engine start',
    unit: 'sec',
    min: 0,
    max: 65535,
    formula: (bytes) => (bytes[0] * 256) + bytes[1],
  },
  '21': {
    pid: '0121',
    name: 'Distance MIL',
    description: 'Distance traveled with MIL on',
    unit: 'km',
    min: 0,
    max: 65535,
    formula: (bytes) => (bytes[0] * 256) + bytes[1],
  },
  '2F': {
    pid: '012F',
    name: 'Fuel Level',
    description: 'Fuel tank level input',
    unit: '%',
    min: 0,
    max: 100,
    formula: (bytes) => (bytes[0] * 100) / 255,
  },
  '42': {
    pid: '0142',
    name: 'Control Voltage',
    description: 'Control module voltage',
    unit: 'V',
    min: 0,
    max: 65.535,
    formula: (bytes) => ((bytes[0] * 256) + bytes[1]) / 1000,
  },
  '46': {
    pid: '0146',
    name: 'Ambient Temp',
    description: 'Ambient air temperature',
    unit: '째C',
    min: -40,
    max: 215,
    formula: (bytes) => bytes[0] - 40,
  },
  '5C': {
    pid: '015C',
    name: 'Oil Temp',
    description: 'Engine oil temperature',
    unit: '째C',
    min: -40,
    max: 210,
    formula: (bytes) => bytes[0] - 40,
  },
};

// DTC (Diagnostic Trouble Code) Categories
export const DTC_CATEGORIES: Record<string, string> = {
  'P0': 'Powertrain - Generic',
  'P1': 'Powertrain - Manufacturer Specific',
  'P2': 'Powertrain - Generic',
  'P3': 'Powertrain - Generic/Manufacturer',
  'C0': 'Chassis - Generic',
  'C1': 'Chassis - Manufacturer Specific',
  'C2': 'Chassis - Manufacturer Specific',
  'C3': 'Chassis - Reserved',
  'B0': 'Body - Generic',
  'B1': 'Body - Manufacturer Specific',
  'B2': 'Body - Manufacturer Specific',
  'B3': 'Body - Reserved',
  'U0': 'Network - Generic',
  'U1': 'Network - Manufacturer Specific',
  'U2': 'Network - Manufacturer Specific',
  'U3': 'Network - Reserved',
};

// Common DTC Definitions
export const DTC_DEFINITIONS: Record<string, string> = {
  'P0100': 'Mass or Volume Air Flow Circuit Malfunction',
  'P0101': 'Mass or Volume Air Flow Circuit Range/Performance Problem',
  'P0102': 'Mass or Volume Air Flow Circuit Low Input',
  'P0103': 'Mass or Volume Air Flow Circuit High Input',
  'P0110': 'Intake Air Temperature Circuit Malfunction',
  'P0115': 'Engine Coolant Temperature Circuit Malfunction',
  'P0120': 'Throttle Position Sensor/Switch A Circuit Malfunction',
  'P0130': 'O2 Sensor Circuit Malfunction (Bank 1 Sensor 1)',
  'P0131': 'O2 Sensor Circuit Low Voltage (Bank 1 Sensor 1)',
  'P0132': 'O2 Sensor Circuit High Voltage (Bank 1 Sensor 1)',
  'P0133': 'O2 Sensor Circuit Slow Response (Bank 1 Sensor 1)',
  'P0134': 'O2 Sensor Circuit No Activity Detected (Bank 1 Sensor 1)',
  'P0171': 'System Too Lean (Bank 1)',
  'P0172': 'System Too Rich (Bank 1)',
  'P0300': 'Random/Multiple Cylinder Misfire Detected',
  'P0301': 'Cylinder 1 Misfire Detected',
  'P0302': 'Cylinder 2 Misfire Detected',
  'P0303': 'Cylinder 3 Misfire Detected',
  'P0304': 'Cylinder 4 Misfire Detected',
  'P0305': 'Cylinder 5 Misfire Detected',
  'P0306': 'Cylinder 6 Misfire Detected',
  'P0307': 'Cylinder 7 Misfire Detected',
  'P0308': 'Cylinder 8 Misfire Detected',
  'P0325': 'Knock Sensor 1 Circuit Malfunction (Bank 1)',
  'P0335': 'Crankshaft Position Sensor A Circuit Malfunction',
  'P0340': 'Camshaft Position Sensor Circuit Malfunction',
  'P0400': 'Exhaust Gas Recirculation Flow Malfunction',
  'P0401': 'Exhaust Gas Recirculation Flow Insufficient Detected',
  'P0420': 'Catalyst System Efficiency Below Threshold (Bank 1)',
  'P0430': 'Catalyst System Efficiency Below Threshold (Bank 2)',
  'P0440': 'Evaporative Emission Control System Malfunction',
  'P0442': 'Evaporative Emission Control System Leak Detected (small leak)',
  'P0446': 'Evaporative Emission Control System Vent Control Circuit Malfunction',
  'P0455': 'Evaporative Emission Control System Leak Detected (large leak)',
  'P0500': 'Vehicle Speed Sensor Malfunction',
  'P0505': 'Idle Control System Malfunction',
  'P0507': 'Idle Control System RPM Higher Than Expected',
  'P0600': 'Serial Communication Link Malfunction',
  'P0700': 'Transmission Control System Malfunction',
  'P0715': 'Input/Turbine Speed Sensor Circuit Malfunction',
  'P0720': 'Output Speed Sensor Circuit Malfunction',
  'P0730': 'Incorrect Gear Ratio',
  'P0740': 'Torque Converter Clutch Circuit Malfunction',
  'P0750': 'Shift Solenoid A Malfunction',
};

// ELM327 AT Commands
export const ELM327_COMMANDS = {
  RESET: 'ATZ',
  ECHO_OFF: 'ATE0',
  LINEFEED_OFF: 'ATL0',
  HEADERS_ON: 'ATH1',
  HEADERS_OFF: 'ATH0',
  SPACES_OFF: 'ATS0',
  AUTO_PROTOCOL: 'ATSP0',
  DESCRIBE_PROTOCOL: 'ATDP',
  READ_VOLTAGE: 'ATRV',
  VERSION: 'ATI',
};

// OBD Modes
export const OBD_MODES = {
  CURRENT_DATA: '01',
  FREEZE_FRAME: '02',
  STORED_DTCS: '03',
  CLEAR_DTCS: '04',
  OXYGEN_SENSORS: '05',
  TEST_RESULTS: '06',
  PENDING_DTCS: '07',
  CONTROL_OPERATION: '08',
  VEHICLE_INFO: '09',
  PERMANENT_DTCS: '0A',
};
